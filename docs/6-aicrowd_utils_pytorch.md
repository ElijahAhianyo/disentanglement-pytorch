# Aicrowd Utils Pytorch

[_Documentation generated by Documatic_](https://www.documatic.com)

<!---Documatic-section-Codebase Structure-start--->
## Codebase Structure

<!---Documatic-block-system_architecture-start--->
```mermaid
None
```
<!---Documatic-block-system_architecture-end--->

# #
<!---Documatic-section-Codebase Structure-end--->

<!---Documatic-section-aicrowd.utils_pytorch.get_config-start--->
## aicrowd.utils_pytorch.get_config

<!---Documatic-section-get_config-start--->
<!---Documatic-block-aicrowd.utils_pytorch.get_config-start--->
<details>
	<summary><code>aicrowd.utils_pytorch.get_config</code> code snippet</summary>

```python
def get_config():
    return ExperimentConfig(base_path=os.getenv('AICROWD_OUTPUT_PATH', './scratch/shared'), experiment_name=os.getenv('AICROWD_EVALUATION_NAME', 'experiment_name'), dataset_name=os.getenv('AICROWD_DATASET_NAME', 'cars3d'))
```
</details>
<!---Documatic-block-aicrowd.utils_pytorch.get_config-end--->
<!---Documatic-section-get_config-end--->

# #
<!---Documatic-section-aicrowd.utils_pytorch.get_config-end--->

<!---Documatic-section-aicrowd.utils_pytorch.use_cuda-start--->
## aicrowd.utils_pytorch.use_cuda

<!---Documatic-section-use_cuda-start--->
<!---Documatic-block-aicrowd.utils_pytorch.use_cuda-start--->
<details>
	<summary><code>aicrowd.utils_pytorch.use_cuda</code> code snippet</summary>

```python
def use_cuda():
    return torch.cuda.is_available() and os.getenv('AICROWD_CUDA', True)
```
</details>
<!---Documatic-block-aicrowd.utils_pytorch.use_cuda-end--->
<!---Documatic-section-use_cuda-end--->

# #
<!---Documatic-section-aicrowd.utils_pytorch.use_cuda-end--->

<!---Documatic-section-aicrowd.utils_pytorch.get_model_path-start--->
## aicrowd.utils_pytorch.get_model_path

<!---Documatic-section-get_model_path-start--->
<!---Documatic-block-aicrowd.utils_pytorch.get_model_path-start--->
<details>
	<summary><code>aicrowd.utils_pytorch.get_model_path</code> code snippet</summary>

```python
def get_model_path(base_path=None, experiment_name=None, make=True):
    base_path = os.getenv('AICROWD_OUTPUT_PATH', '../scratch/shared') if base_path is None else base_path
    experiment_name = os.getenv('AICROWD_EVALUATION_NAME', 'experiment_name') if experiment_name is None else experiment_name
    model_path = os.path.join(base_path, experiment_name, 'representation', 'pytorch_model.pt')
    if make:
        os.makedirs(os.path.dirname(model_path), exist_ok=True)
        os.makedirs(os.path.join(os.path.dirname(model_path), 'results'), exist_ok=True)
    return model_path
```
</details>
<!---Documatic-block-aicrowd.utils_pytorch.get_model_path-end--->
<!---Documatic-section-get_model_path-end--->

# #
<!---Documatic-section-aicrowd.utils_pytorch.get_model_path-end--->

<!---Documatic-section-aicrowd.utils_pytorch.export_model-start--->
## aicrowd.utils_pytorch.export_model

<!---Documatic-section-export_model-start--->
```mermaid
flowchart LR
aicrowd.utils_pytorch.export_model-->aicrowd.utils_pytorch.get_model_path
```

### Object Calls

* aicrowd.utils_pytorch.get_model_path

<!---Documatic-block-aicrowd.utils_pytorch.export_model-start--->
<details>
	<summary><code>aicrowd.utils_pytorch.export_model</code> code snippet</summary>

```python
def export_model(model, path=None, input_shape=(1, 3, 64, 64)):
    path = get_model_path() if path is None else path
    model = deepcopy(model).cpu().eval()
    if not isinstance(model, torch.jit.ScriptModule):
        assert input_shape is not None, '`input_shape` must be provided since model is not a `ScriptModule`.'
        traced_model = trace(model, torch.zeros(*input_shape))
    else:
        traced_model = model
    torch.jit.save(traced_model, path)
    return path
```
</details>
<!---Documatic-block-aicrowd.utils_pytorch.export_model-end--->
<!---Documatic-section-export_model-end--->

# #
<!---Documatic-section-aicrowd.utils_pytorch.export_model-end--->

<!---Documatic-section-aicrowd.utils_pytorch.import_model-start--->
## aicrowd.utils_pytorch.import_model

<!---Documatic-section-import_model-start--->
```mermaid
flowchart LR
aicrowd.utils_pytorch.import_model-->aicrowd.utils_pytorch.get_model_path
```

### Object Calls

* aicrowd.utils_pytorch.get_model_path

<!---Documatic-block-aicrowd.utils_pytorch.import_model-start--->
<details>
	<summary><code>aicrowd.utils_pytorch.import_model</code> code snippet</summary>

```python
def import_model(path=None):
    path = get_model_path() if path is None else path
    return torch.jit.load(path)
```
</details>
<!---Documatic-block-aicrowd.utils_pytorch.import_model-end--->
<!---Documatic-section-import_model-end--->

# #
<!---Documatic-section-aicrowd.utils_pytorch.import_model-end--->

<!---Documatic-section-aicrowd.utils_pytorch.make_representor-start--->
## aicrowd.utils_pytorch.make_representor

<!---Documatic-section-make_representor-start--->
```mermaid
flowchart LR
aicrowd.utils_pytorch.make_representor-->aicrowd.utils_pytorch.use_cuda
```

### Object Calls

* aicrowd.utils_pytorch.use_cuda

<!---Documatic-block-aicrowd.utils_pytorch.make_representor-start--->
<details>
	<summary><code>aicrowd.utils_pytorch.make_representor</code> code snippet</summary>

```python
def make_representor(model, cuda=None):
    cuda = use_cuda() if cuda is None else cuda
    model = model.cuda() if cuda else model.cpu()

    def _represent(x):
        assert isinstance(x, np.ndarray), 'Input to the representation function must be a ndarray.'
        assert x.ndim == 4, 'Input to the representation function must be a four dimensional NHWC tensor.'
        x = np.moveaxis(x, 3, 1)
        x = torch.from_numpy(x).float().to('cuda' if cuda else 'cpu')
        with torch.no_grad():
            y = model(x)
        y = y.cpu().numpy()
        assert y.ndim == 2, 'The returned output from the representor must be two dimensional (NC).'
        return y
    return _represent
```
</details>
<!---Documatic-block-aicrowd.utils_pytorch.make_representor-end--->
<!---Documatic-section-make_representor-end--->

# #
<!---Documatic-section-aicrowd.utils_pytorch.make_representor-end--->

[_Documentation generated by Documatic_](https://www.documatic.com)